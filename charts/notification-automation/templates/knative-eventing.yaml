{{- if .Values.eventing.install }}
apiVersion: operator.knative.dev/v1beta1
kind: KnativeEventing
metadata:
  name: knative-eventing
  namespace: {{ .Values.eventing.namespace }}
  annotations:
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-weight": "-5"
spec:
  config:
    config-features:
      authentication-oidc: {{ if .Values.eventing.authenticationOidc }}enabled{{ else }}disabled{{ end }}
      eventtype-auto-create: enabled
    default-ch-webhook:
      default-ch-config: |
        clusterDefault:
          apiVersion: messaging.knative.dev/v1
          kind: InMemoryChannel
          spec:
            delivery:
              backoffDelay: PT0.5S
              backoffPolicy: exponential
              retry: 5
  version: {{ .Values.eventing.version }}
{{- end }}
